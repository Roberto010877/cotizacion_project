class TablaCorrelativos(SoftDeleteMixin, models.Model):
    nombre = models.CharField(max_length=50, unique=True)
    serie = models.CharField(max_length=5, unique=True)  # Prefijo (ej: 'PROD', 'VENT', 'F00')
    numero = models.PositiveIntegerField(default=1)  # Número correlativo
    estado = models.CharField(
        max_length=12,
        choices=[('Activo', 'Activo'), ('Inactivo', 'Inactivo')],
        default='Activo'
    )

    class Meta:
        db_table = "common_tabla_correlativos"
        verbose_name = "Tabla de Correlativos"
        ordering = ['id']

    def __str__(self):
        return f"{self.nombre} ({self.serie}-{self.formato_numero()})"

    def formato_numero(self):
        """Genera el número correlativo con ceros a la izquierda (ej: '0000001')"""
        return str(self.numero).zfill(7)

    def generar_codigo_documento(self):
        """Genera el código completo, combinando serie y número correlativo"""
        return f"{self.serie}-{self.formato_numero()}"

    def actualizar_numero(self):
        """Incrementa el número y lo guarda"""
        self.numero += 1
        self.save()



        class TablaCorrelativosViewSet(UserAuditMixin, viewsets.ModelViewSet):
    queryset = TablaCorrelativos.objects.filter(eliminado=False).order_by('nombre')
    serializer_class = TablaCorrelativosSerializer
    permission_classes = [IsAuthenticated, DjangoModelPermissions]
    filter_backends = [SearchFilter, OrderingFilter, DjangoFilterBackend]
    search_fields = ['nombre', 'serie', 'numero']
    ordering_fields = ['nombre', 'fecha_creacion', 'fecha_modificacion']
    ordering = ['nombre']
    pagination_class = StandardPagination